(()=>{const e=document.querySelector.bind(document),{createFFmpeg:t}=FFmpeg,o={1:{screen:{audio:!1}},2:{screen:{audio:!0}},3:{cam:{audio:!1}},4:{cam:{audio:!0}}},i={1:{width:640,height:360},2:{width:1280,height:720},3:{width:1920,height:1080},4:{width:2560,height:1440},5:{width:3840,height:2160}};let a=!1,s=0,n=0,r=0;function d(e,t,o){this.mediaRecoder=new MediaRecorder(e,t),this.recordedChunks=[],this.handleDataAvailable=e=>{e.data.size>0&&(this.recordedChunks.push(e.data),console.log("Audio BPS: "+this.mediaRecoder.audioBitsPerSecond),console.log("Video BPS: "+this.mediaRecoder.videoBitsPerSecond),o(new Blob(this.recordedChunks)))},this.startRecording=()=>this.mediaRecoder.start(),this.stopRecording=()=>this.mediaRecoder.stop(),this.mediaRecoder.ondataavailable=this.handleDataAvailable}async function c(o){e("#video-processing").classList.toggle("fade");const i=await async function(o){const i=t({logger:t=>function(t,o,i){const{message:a}=i;a.startsWith("frame=")&&(e("#progress-bar-outer").style.width=a.split(/\s+/)[1]/(30*o)*100+"%")}(0,r,t)});await i.load();const a=await o.arrayBuffer();i.FS("writeFile","input.webm",new Uint8Array(a,0,a.byteLength)),await i.run("-i","input.webm","-c:v","libx264","-preset","ultrafast","-crf","27","output.mp4");const s=i.FS("readFile","output.mp4");return new Blob([s.buffer],{type:"video/mp4"})}(o);e("#progress-bar-outer").style.width="100%",e("#processing-text").style.display="none",e("#complete-text").style.display="block",setTimeout((()=>{e("#video-processing").classList.toggle("fade"),setTimeout((()=>{e("#processing-text").style.display="",e("#complete-text").style.display="none",e("#progress-bar-outer").style.width="0%"}),400)}),2500);const a=URL.createObjectURL(i),s=document.createElement("a");s.href=a,s.download=(new Date).toLocaleString()+".mp4",s.click()}(async()=>{let t,l;e("#recording").addEventListener("click",(async()=>{if(a)n=new Date,r=(n-s)/1e3,t.getTracks().forEach((e=>e.stop())),l.stopRecording(),e("#recording").classList.remove("btn-red"),e("#recording").textContent="Record Now",a=!1;else{const n=o[e("#recording-type").value],r=i[e("#resolution-option").value];t=n.screen?await navigator.mediaDevices.getDisplayMedia({video:r,audio:!!n.screen.audio&&{autoGainControl:!1,echoCancellation:!1,googAutoGainControl:!1,noiseSuppression:!1},frameRate:30}):await navigator.mediaDevices.getUserMedia({video:r,audio:!!n.cam&&{autoGainControl:!1,echoCancellation:!1,googAutoGainControl:!1,noiseSuppression:!1},frameRate:30}),l=new d(t,{mimeType:"video/webm; codecs=vp8",audioBitsPerSecond:128e3},c),l.startRecording();const u=e("#streaming");u.srcObject=t,u.onloadedmetadata=e=>u.play(),e("#recording").classList.add("btn-red"),e("#recording").textContent="Stop Recording",a=!0,s=new Date}}))})()})();