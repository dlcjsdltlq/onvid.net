(()=>{const e=document.querySelector.bind(document),{createFFmpeg:t}=FFmpeg,i={1:{screen:{audio:!1}},2:{screen:{audio:!0}},3:{cam:{audio:!1}},4:{cam:{audio:!0}}},o={1:{width:640,height:360},2:{width:1280,height:720},3:{width:1920,height:1080},4:{width:2560,height:1440},5:{width:3840,height:2160}};let a=!1;function n(e,t,i){this.mediaRecoder=new MediaRecorder(e,t),this.recordedChunks=[],this.handleDataAvailable=e=>{e.data.size>0&&(this.recordedChunks.push(e.data),console.log("Audio BPS: "+this.mediaRecoder.audioBitsPerSecond),console.log("Video BPS: "+this.mediaRecoder.videoBitsPerSecond),i(new Blob(this.recordedChunks)))},this.startRecording=()=>this.mediaRecoder.start(),this.stopRecording=()=>this.mediaRecoder.stop(),this.mediaRecoder.ondataavailable=this.handleDataAvailable}async function s(i){e("#video-processing").classList.toggle("fade");const o=await async function(e){const i=t({log:!0});await i.load();const o=await e.arrayBuffer();i.FS("writeFile","input.webm",new Uint8Array(o,0,o.byteLength)),await i.run("-i","input.webm","-c:v","libx264","-preset","ultrafast","-crf","27","output.mp4");const a=i.FS("readFile","output.mp4");return new Blob([a.buffer],{type:"video/mp4"})}(i);e("#spinner").style.display="none",e("#processing-text").style.display="none",e("#complete-text").style.display="inline",setTimeout((()=>{e("#video-processing").classList.toggle("fade"),setTimeout((()=>{e("#spinner").style.display="",e("#processing-text").style.display="",e("#complete-text").style.display="none"}),400)}),2500);const a=URL.createObjectURL(o),n=document.createElement("a");n.href=a,n.download=(new Date).toLocaleString()+".mp4",n.click()}(async()=>{let t,d;e("#recording").addEventListener("click",(async()=>{if(a)t.getTracks().forEach((e=>e.stop())),d.stopRecording(),e("#recording").classList.remove("btn-red"),e("#recording").textContent="Record Now",a=!1;else{const r=i[e("#recording-type").value],c=o[e("#resolution-option").value];t=r.screen?await navigator.mediaDevices.getDisplayMedia({video:c,audio:!!r.screen.audio&&{autoGainControl:!1,echoCancellation:!1,googAutoGainControl:!1,noiseSuppression:!1},frameRate:30}):await navigator.mediaDevices.getUserMedia({video:c,audio:!!r.cam&&{autoGainControl:!1,echoCancellation:!1,googAutoGainControl:!1,noiseSuppression:!1},frameRate:30}),d=new n(t,{mimeType:"video/webm; codecs=vp8",audioBitsPerSecond:128e3},s),d.startRecording();const l=e("#streaming");l.srcObject=t,l.onloadedmetadata=e=>l.play(),e("#recording").classList.add("btn-red"),e("#recording").textContent="Stop Recording",a=!0}}))})()})();